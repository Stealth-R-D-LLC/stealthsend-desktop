Build Linux:
  image: nexus.barrage.net:13455/barrage-internal/electronjs-builder
  script:
    - apt-get update ; apt-get --yes install rsync
    - cp -R ./ /project
    - cd /project
    - npm install --only=prod --no-package-lock
    - npm run electron:build --linux
    - cd $CI_PROJECT_DIR
    - rsync -r /project/dist_electron ./
  tags:
    - docker-executor
  artifacts:
    paths:
      - dist_electron/*.AppImage
      - dist_electron/*.deb

Build MacOS:
  script:
    - source ~/.zshrc
    - WORKDIR=$(mktemp -d)
    - rsync -r --exclude=.git ./ "$WORKDIR"
    - cd "$WORKDIR"
    - nvm use 14
    - npm install --no-package-lock --registry=https://nexus.barrage.net/repository/npm.barrage.net/ --username=gitlab-ci-readonly --password=$CI_NEXUS_DOCKER_REGISTRY_READ_ONLY
    - npm run electron:build --mac
    - cd $CI_PROJECT_DIR
    - rsync -r $WORKDIR/dist_electron ./
    - rm -rf "$WORKDIR"
    - nvm use default
  tags:
    - macos-electronjs
  artifacts:
    paths:
      - dist_electron/*.dmg
      - dist_electron/*.pkg
